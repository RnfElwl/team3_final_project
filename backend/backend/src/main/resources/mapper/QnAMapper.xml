<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ict.backend.dao.QnADAO">
    <select id = "getQnAList" resultType="com.ict.backend.vo.QnAVO">
        select qna_no, userid, head_title, qna_title,date_format(qna_writedate, '%y-%m-%d %H:%i') qna_writedate,
        privacyQ,qna_state,active_state,qna_pwd from qna_tbl
        where
        <if test="searchWord!=null and searchWord!=''">
            ${searchKey} like '%${searchWord}%' and
        </if>
        active_state IN (1, 2)
        order by qna_no desc
        limit ${onePageRecord} offset ${offset}
    </select>
    <select id="getQnAView" resultType="com.ict.backend.vo.QnAVO">
        select qna_no, userid, head_title, qna_title,qna_content,
        date_format(qna_writedate, '%y-%m-%d %H:%i') qna_writedate,qna_state,qna_answer,
        answer_user, qna_answer_date, active_state,privacyQ,qna_pwd
        from qna_tbl where qna_no=#{qna_no}
    </select>
    <select id="getTotalRecord" resultType="int">
        select count(qna_no) from qna_tbl
        where
        <if test="searchWord!=null and searchWord!=''">
            ${searchKey} like '%${searchWord}%' and
        </if>
        active_state IN (1, 2)
    </select>
    <insert id="qnaInsert">
        insert into qna_tbl (userid, head_title, qna_title, qna_content, qna_state, qna_writedate, privacyQ, active_state, qna_pwd, qna_img)
        values (#{userid}, #{head_title}, #{qna_title}, #{qna_content}, #{qna_state}, NOW(), #{privacyQ}, #{active_state}, #{qna_pwd}, #{qna_img})
    </insert>
    <select id="getQnAViewEdit" resultType="com.ict.backend.vo.QnAVO">
        select qna_no, head_title, qna_title,qna_content,qna_state,privacyQ,qna_pwd
        from qna_tbl where qna_no=#{qna_no}
    </select>
    <update id="qnaUpdate">
        update qna_tbl set qna_title=#{qna_title},qna_content=#{qna_content},privacyQ=#{privacyQ},active_state=#{active_state}
        <if test="qna_pwd!=null and qna_pwd!=''">
            ,qna_pwd=#{qna_pwd}
        </if>
         where qna_no=#{qna_no} and userid=#{userid}
    </update>
    <update id="qnaDel">
        update qna_tbl set active_state=0 where qna_no=#{qna_no} and userid=#{userid}
    </update>
</mapper>